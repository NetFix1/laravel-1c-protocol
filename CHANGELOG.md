# Release Notes

## 7.0.8
 * [New] Добавлена возможность указать нужную кодировку, при использовании пакета `arsengoian/commerce-ml`. Теперь параметр конфигурации `encodeToWindows1251` принимает не только `true` (файл в windows-1251) или `false` (файл в utf-8), но и строку, где можно указать нужную кодировку, например `windows-1253`.

## 7.0.7
 * [Refactor] Переименован тип возвращаемого объекта в методе `Mavsan\LaProtocol\Interfaces\ExportOrders::exportAllOrders(): CommercialBase`, благодаря инструкции `use CommerceML\Implementation\CommercialInformation as CommercialBase`.

## 7.0.6
 * [New] Параметр файла конфигурации `encodeToWindows1251`, который используется при формировании данных о заказах при помощи пакета `arsengoian/commerce-ml`. Если этот параметр - true, то выходной XML будет в кодировке `windows-1251` иначе - `utf-8`.

## 7.0.5
 * [New] Добавлены параметры конфигурации `logCommandsHeaders`, `logCommandsFullUrl`, `sessionID`, `defaultType`, `isBitrixOn1C`, `saleXmlVersion`, `catalogXmlVersion`. Все эти параметры подробно описаны в файле конфигурации.
 * [New] Добавлена возможность указать постоянный ИД сессии (параметр `sessionID` файла конфигурации), чтобы не плодить лишние, т.к. битрикс за одну сессию обмена данными может делать авторизацию более одного раза.
 * [New] Если в файле конфигурации указано, что на стороне 1С работает модуль обмена данными от 1С-Битрикс, то отправляются ответы, как это описано в [документации](https://dev.1c-bitrix.ru/api_help/sale/algorithms/index.php) к 1С Битрикс (анализ ответов показал, что они игнорируются или - изменился стандарт, о чем они забыли написать, например: я указываю, что мне необходим файл версиии 2.1, но 1С упрямо шлет мне данные версии 3.1).
 * [New] Добавлен интерфейс `Mavsan\LaProtocol\Interfaces\ImportBitrix`. Если модель обработки каталога реализует этот интерфейс и если прийдет от 1С команда `deactivate`, то будет вызван метод `modeDeactivate($startTime = null)` этого интерфейса, где `$startTime` - метка времени начала обмена, которую присылает 1С. После того, как прийдет команда `complete` - будет вызван метод `modeComplete()`.
 * [New] Добавлен интерфейс `Mavsan\LaProtocol\Interfaces\ExportSuccess`. Если при выгрузке заказов с сайта прийдет эта команда, в случае, если модель формирования данных о заказах реализует этот интерфейс, то будет вызван метод `stepSuccess()` этого интерфейса.
 * [BugFix] Исправлена ошибка сохранения сессии. Оказалось, что при авторизации `Auth::attempt(...)` изменяется идентификатор сессии, поэтому сессия и теряется.
 * [Refactor] Убрана зависимость от пакета `madnest/madzipper`.

## 7.0.4
 * [BugFix] Исправлена ошибка инициализации сессии. Laravel убрал инициализацию сессии для каждого роута. В файл конфигурации добавлен параметр `middleware`, значением которого должен быть массив. В этом массиве должны быть перечислены промежуточные слои (middleware) или группы промежуточных слоев, которые должен пройти запрос перед попаданием в контроллер. В этих слоях должен быть указан middleware, который отвечает за инициализацию сессии. **Без инициализации сессии ничего работать не будет!** Сейчас это группа промежуточных слоев - `web`. Т.е. надо создать группу посредников, добавить туда посредник инициализации сессии и прописать эту группу в файле конфигурации. В этой группе **не должно быть** посредника шифрования куки.

## 7.0.3
 * обновлена инструкция по установке для Laravel 5

## 7.0.2
 * [New] убрана зависимость от пакета arsengoian/commerce-ml. Теперь, для формирования XML с данными о заказах, можно использовать `arsengoian/commerce-ml` или прописать свою модель, формирующую ответ для 1С

## 7.0.1
 * [New] добавлен пакет madnest/madzipper вместо chumper/zipper
 * [Refactor] убрана зависимость от пакета chumper/zipper, т.к. он работает только с Laravel 5
 * [Refactor] убрана зависимость от Laravel 5.4

## 0.0.15
 * changelog

## 0.0.14
 * [New] Добавлен функционал экспорта данных в 1С
 * [BugFix] Ошибка создания каталога (недопустимые символы), куда будут приниматься файлы в OS Windows

## 0.0.13
 * [BugFix] тесты, если в конфиге задан гейт - тест авторизации ломается

## 0.0.12
 * [New] Добавлена обработка гейтов. Теперь можно задать дополнительные правила авторизации для пользователя. К примеру, проверку наличие необходимой роли.

## 0.0.11
 * [New] В файл конфигурации добавлен параметр `logCommandsOf1C` включающий вывод в лог команд, присылаемых от 1С.
 * [Update] Обновлена инструкция

## 0.0.10
 * [Refactor] Обновлено тестирование и инструкции.
 * [New] В интерфейс модели, обрабатывающей каталог добавлен метод `getAnswerDetail()`, который должен возвращать детализированный ответ о текущем шаге, например: 'Обработано XXX записей из XXXXX'. 

## 0.0.9
 * [Bug-fix] В контроллер добавлено отлавливание исключений распаковки файлов.
 * [Refactor] В read.me изменена инструкция по тестам.
 * [Bug-fix] Алиас конфига.

## 0.0.8
 * В файле конфигурации добавлены параметры для указания имени пользователя и пароля для тестов. Если пользователь не существует - создаётся, но НЕ УДАЛЯЕТСЯ.
 * Алиас файла конфигурации изменен с `protocol` на `la1CProtocol`.
